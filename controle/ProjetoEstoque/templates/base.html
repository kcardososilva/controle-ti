{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Controle TI{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="{% static 'img/logo2.png' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap">

  <style>
    /* ===========================
       TOKENS / PALETA
       =========================== */
    :root{
      --bg:#0b1120; --bg-soft:#0f172a; --surface:#111827; --surface-2:#0f172a;
      --text:#e5e7eb; --muted:#94a3b8; --line:#223047;

      --brand-1:#1e3a8a; --brand-2:#2563eb; --accent:#06b6d4;
      --ok:#16a34a; --warn:#d97706; --bad:#ef4444; --info:#38bdf8;

      --sidebar-w:210px; --radius:12px; --shadow:0 14px 34px rgba(0,0,0,.35);
      --sidebar-bg:linear-gradient(135deg, var(--brand-1) 0%, #1b2b5f 100%);
      --sidebar-active:#2c3c5c; --sidebar-txt:#e6f1ff; --sidebar-txt-active:#ffffff;

      --header-h:72px; --header-bg:linear-gradient(135deg, var(--brand-1) 0%, var(--brand-2) 100%);
      --header-txt:#f0f5ff;

      --btn-sair-bg:#1f2a44; --btn-sair-txt:#ffffff;

      --page-bg:#f6f8fc;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f5f7fb; --bg-soft:#ffffff; --surface:#ffffff; --surface-2:#f8fafc;
        --text:#0f172a; --muted:#64748b; --line:#e5e7eb;

        --sidebar-bg:linear-gradient(135deg,#1e3a8a 0%,#2a55d4 100%);
        --sidebar-active:#dbe6ff33; --sidebar-txt:#f8fbff; --sidebar-txt-active:#ffffff;

        --header-bg:linear-gradient(135deg,#ffffff 0%,#ffffff 100%);
        --btn-sair-bg:#e8eefc; --btn-sair-txt:#172554;

        --page-bg:#f6f8fc; --shadow:0 18px 40px rgba(2,6,23,.08);
      }
    }

    html,body{height:100%;margin:0}
    body{
      font-family:'Roboto',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--text); min-height:100vh;
    }
    *{box-sizing:border-box}
    .layout{display:flex;min-height:100vh}

    /* ===========================
       SIDEBAR
       =========================== */
    .sidebar{
      position:fixed; inset:0 auto 0 0; width:var(--sidebar-w);
      background:#0f172a ;
      display:flex; flex-direction:column; padding-top:8px;
      box-shadow:4px 0 24px rgba(0,0,0,.3);
      z-index:220; transform:translateX(0);
      transition:transform .25s cubic-bezier(.7,.22,.2,1);
    }
    /* üîß MOBILE: sidebar fechada por padr√£o e abr√≠vel como drawer */
    @media (max-width:900px){
      .sidebar{ transform:translateX(-100%) }
      .sidebar.open{ transform:translateX(0) }
    }

    .sidebar-close{
      display:none; color:#fff; font-size:1.8rem; background:none; border:none; cursor:pointer;
      margin: 6px 10px 6px auto;
    }
    @media (max-width:900px){ .sidebar-close{ display:block } }

    .sidebar-logo{
      font-size:1.2rem; font-weight:700; color:var(--sidebar-txt);
      display:flex; align-items:center; gap:10px; margin:4px 12px 8px 16px; letter-spacing:.2px;
    }

    /* üîß AQUI EST√Å O PULO DO GATO: a √°rea de menu √© rol√°vel */
    .sidebar-menu{
      flex:1;
      display:flex; flex-direction:column; gap:2px;
      overflow-y:auto;              /* permite rolar a lista longa */
      overscroll-behavior:contain;  /* evita ‚Äúpuxar‚Äù o body por engano */
      -webkit-overflow-scrolling:touch; /* rolagem suave no iOS */
      padding:4px 0 24px 0;         /* espa√ßo inferior */
      padding-bottom: calc(24px + env(safe-area-inset-bottom, 0px));
      scrollbar-gutter: stable;     /* evita ‚Äúpulos‚Äù do conte√∫do */
      max-height: 100%;
    }
    /* scrollbar discreta */
    .sidebar-menu::-webkit-scrollbar{width:8px}
    .sidebar-menu::-webkit-scrollbar-thumb{background:#ffffff33;border-radius:10px}
    .sidebar-menu::-webkit-scrollbar-track{background:transparent}

    .sidebar-link{
      padding:10px 12px 10px 18px; color:var(--sidebar-txt);
      display:flex; align-items:center; gap:12px;
      border-radius:10px; margin:1px 6px; text-decoration:none; font-weight:500;
      transition:background .12s ease, color .12s ease;
    }
    .sidebar-link i{min-width:22px;text-align:center;color:#eaf3ff}
    .sidebar-link:hover{ background:var(--sidebar-active); color:var(--sidebar-txt-active) }
    .sidebar-link.active{ background:var(--sidebar-active); color:var(--sidebar-txt-active); font-weight:700 }

    .submenu{
      background:linear-gradient(360deg,rgba(255,255,255,.08) 0%,rgba(255,255,255,.02) 100%);
      border-radius:8px; margin:4px 10px 8px 28px; padding:6px 6px 6px 10px;
      display:flex; flex-direction:column; gap:2px; box-shadow:0 3px 14px rgba(0,0,0,.1);
    }
    .submenu-link{
      color:#f1f7ff; font-size:.96rem; padding:7px 8px; border-radius:6px; text-decoration:none;
      transition:background .12s ease, color .12s ease;
    }
    .submenu-link:hover{ background:rgba(255,255,255,.2); color:#fff; font-weight:700 }
    .hidden{display:none!important}

    /* Overlay do drawer */
    .sidebar-overlay{
      position:fixed; inset:0; background:#001828e6; z-index:210;
      opacity:0; pointer-events:none; transition:opacity .18s;
    }
    .sidebar.open ~ .sidebar-overlay{ opacity:1; pointer-events:auto }

    /* ===========================
       HEADER
       =========================== */
    .header{
      position:fixed; top:0; left:var(--sidebar-w);
      height:var(--header-h); width:calc(100vw - var(--sidebar-w));
      background:var(--header-bg); color:var(--header-txt);
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; gap:10px; padding:0 16px; z-index:300; box-sizing:border-box;
    }
    @media (max-width:900px){ .header{ left:0; width:100vw } }

    .hamburger{
      display:inline-flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.3); color:#eaf9fc; border:none; border-radius:8px; width:40px; height:38px;
      cursor:pointer; box-shadow:0 1px 8px rgba(0,0,0,.25);
    }
    @media (min-width:901px){ .hamburger{ display:none } }

    .header-main{ display:flex; align-items:center; gap:10px; min-width:0; flex:1 }
    .header-user{ color:#000000; font-size:1rem; font-weight:500; white-space:nowrap }
    .btn-sair{
      padding:8px 16px; background:var(--btn-sair-bg); color:var(--btn-sair-txt);
      border:none; border-radius:10px; font-weight:700; cursor:pointer;
      transition:filter .12s ease, transform .04s ease;
    }
    .btn-sair:hover{ filter:brightness(1.08) }
    .btn-sair:active{ transform:translateY(1px) }

    /* ===========================
       MAIN
       =========================== */
    .main-content{
      margin-left:var(--sidebar-w); margin-top:var(--header-h);
      height:calc(100vh - var(--header-h)); overflow:auto;
      box-sizing:border-box; padding:24px 28px 0 28px; 
      background:var(--page-bg);
    }
    @media (max-width:900px){ .main-content{ margin-left:0; width:100vw } }

    :focus-visible{ outline:3px solid #93c5fd; outline-offset:2px; border-radius:8px }
  </style>
</head>
<body>
  <div class="layout">
    <!-- SIDEBAR -->
    <nav class="sidebar" id="sidebarMenu" aria-label="Menu lateral">
      <button class="sidebar-close" onclick="closeSidebar()" title="Fechar menu" aria-label="Fechar menu">
        <i class="fas fa-times"></i>
      </button>

      <div class="sidebar-logo">
        <i class="fas fa-network-wired" aria-hidden="true"></i> Controle TI
      </div>

      <div class="sidebar-menu">
        <div class="sidebar-link-with-sub">
          <a class="sidebar-link" href="#" onclick="toggleSubmenu(event,'dashboard-sub')" aria-expanded="false" aria-controls="dashboard-sub">
            <i class="fas fa-chart-bar" aria-hidden="true"></i> Dashboard
            <i class="fas fa-chevron-down" style="margin-left:auto;font-size:.92em" aria-hidden="true"></i>
          </a>
          <div class="submenu hidden" id="dashboard-sub" role="region" aria-label="Submenu Dashboard">
            <a href="{% url 'dashboard' %}" class="submenu-link">Vis√£o Geral</a>
            <a href="{% url 'cc_custos_dashboard' %}" class="submenu-link">Custo por setor</a>
            <a href="{% url 'licencas_dashboard' %}" class="submenu-link">Dashboard Licen√ßas</a>
            <a href="{% url 'dashboard_toner' %}" class="submenu-link">Gastos com Toner</a>
            <a href="{% url 'preventiva_dashboard' %}" class="submenu-link">Preventiva</a>
          </div>
        </div>

        <a class="sidebar-link" href="{% url 'equipamentos_list' %}">
          <i class="fas fa-laptop" aria-hidden="true"></i> Itens
        </a>
        <a class="sidebar-link" href="{% url 'licenca_list' %}">
          <i class="fa-solid fa-rocket" aria-hidden="true"></i> Licen√ßas
        </a>
        <a class="sidebar-link" href="{% url 'movimentacao_list' %}">
          <i class="fa fa-exchange-alt" aria-hidden="true"></i> Movimenta√ß√µes
        </a>

        <div class="sidebar-link-with-sub">
          <a class="sidebar-link" href="#" onclick="toggleSubmenu(event,'ativos-sub')" aria-expanded="false" aria-controls="ativos-sub">
            <i class="fas fa-server" aria-hidden="true"></i> Cadastro de Ativos
            <i class="fas fa-chevron-down" style="margin-left:auto;font-size:.92em" aria-hidden="true"></i>
          </a>
          <div class="submenu hidden" id="ativos-sub" role="region" aria-label="Submenu Cadastro de Ativos">
            <a href="{% url 'cadastrar_equipamento' %}" class="submenu-link">Item</a>
            <a href="{% url 'subtipo_list' %}" class="submenu-link">Subtipo</a>
          </div>
        </div>

        <a class="sidebar-link" href="{% url 'localidade_list' %}">
          <i class="fas fa-map-pin" aria-hidden="true"></i> Localidades
        </a>
        <a class="sidebar-link" href="{% url 'centrocusto_list' %}">
          <i class="fas fa-dollar-sign" aria-hidden="true"></i> Centro de Custos
        </a>
        <a class="sidebar-link" href="{% url 'fornecedor_list' %}">
          <i class="fas fa-building" aria-hidden="true"></i> Fornecedores
        </a>
        <a class="sidebar-link" href="{% url 'usuario_list' %}">
          <i class="fas fa-user" aria-hidden="true"></i> Usu√°rios
        </a>
        <a class="sidebar-link" href="{% url 'funcoes_list' %}">
          <i class="fa-solid fa-address-card" aria-hidden="true"></i> Fun√ß√µes
        </a>

        <div class="sidebar-link-with-sub">
          <a class="sidebar-link" href="#" onclick="toggleSubmenu(event,'preventivas-sub')" aria-expanded="false" aria-controls="preventivas-sub">
            <i class="fas fa-screwdriver-wrench" aria-hidden="true"></i> Sistemas de Preventivas
            <i class="fas fa-chevron-down" style="margin-left:auto;font-size:.92em" aria-hidden="true"></i>
          </a>
          <div class="submenu hidden" id="preventivas-sub" role="region" aria-label="Submenu Preventivas">
            <a class="submenu-link" href="{% url 'preventiva_start' %}">
              <i class="fa fa-play-circle" aria-hidden="true"></i> Iniciar Preventiva (Geral)
            </a>
            <a class="submenu-link" href="{% url 'checklist_list' %}">
              <i class="fa fa-list" aria-hidden="true"></i> Listar Checklists
            </a>
            <a class="submenu-link" href="{% url 'preventiva_list' %}">
              <i class="fa fa-table-list" aria-hidden="true"></i> Listar Preventivas
            </a>
          </div>
        </div>

        <a class="sidebar-link" href="{% url 'sobre_plataforma' %}">
          <i class="fas fa-blog" aria-hidden="true"></i> Sobre a plataforma
        </a>
      </div>
    </nav>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()" aria-hidden="true"></div>

    <!-- HEADER + MAIN -->
    <div style="flex:1; display:flex; flex-direction:column;">
      <header class="header" role="banner">
        <button class="hamburger" id="hamburgerBtn" onclick="openSidebar()" title="Abrir menu" aria-label="Abrir menu">
          <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
        <div class="header-main">
          <span class="header-user">Bem-vindo, {{ user.username }}</span>
        </div>
        <a href="{% url 'login' %}" class="btn-sair" rel="nofollow">Sair</a>
      </header>

      <main class="main-content" role="main" tabindex="-1">
        {% block content %}{% endblock %}
      </main>
    </div>
  </div>

  <script>
    /* Submenus: abre/fecha e fecha os demais */
    function toggleSubmenu(e,id){
      e.preventDefault();
      document.querySelectorAll('.submenu').forEach(el=>{ if(el.id!==id) el.classList.add('hidden'); });
      const sub=document.getElementById(id);
      const willOpen=sub.classList.contains('hidden');
      sub.classList.toggle('hidden');
      e.currentTarget.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
    }

    /* Drawer mobile */
    const sidebar=document.getElementById('sidebarMenu');
    const overlay=document.getElementById('sidebarOverlay');
    const hamburgerBtn=document.getElementById('hamburgerBtn');

    function openSidebar(){
      sidebar.classList.add('open');
      document.body.style.overflow='hidden';
      if(hamburgerBtn) hamburgerBtn.style.display='none';
      /* foca a √°rea rol√°vel para acessibilidade */
      sidebar.querySelector('.sidebar-menu')?.focus?.();
    }
    function closeSidebar(){
      sidebar.classList.remove('open');
      document.body.style.overflow='';
      if(hamburgerBtn) hamburgerBtn.style.display='';
    }

    document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeSidebar(); });
    window.addEventListener('resize',()=>{ if(window.innerWidth>900) closeSidebar(); });
  </script>
</body>
</html>
