{% extends 'base.html' %}
{% block title %}Cadastro de Equipamento{% endblock %}


{% block content %}

<div class="container-formCadastro">
  <h2>Cadastrar Equipamento</h2>
  <form method="post">
    {% csrf_token %}

    <div class="form-group">
      <label for="id_nome">Nome do Equipamento:</label>
      {{ form.nome }}
    </div>

    <div class="form-group">
      <label for="id_categoria">Categoria:</label>
      {{ form.categoria }}
    </div>

    <div class="form-group">
      <label for="id_subtipo">Subtipo:</label>
      <select name="subtipo" id="id_subtipo" required>
        <option value="">Selecione um subtipo...</option>
        {% for subtipo in subtipos %}
          <option value="{{ subtipo.id }}" data-categoria="{{ subtipo.categoria.id }}">{{ subtipo.nome }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group">
      <label for="id_numero_serie">Número de Série:</label>
      {{ form.numero_serie }}
    </div>

    <div class="form-group">
      <label for="id_marca">Marca:</label>
      {{ form.marca }}
    </div>

    <div class="form-group">
      <label for="id_modelo">Modelo:</label>
      {{ form.modelo }}
    </div>

    <div class="form-group">
      <label for="id_local">Local:</label>
      {{ form.local }}
    </div>

    <div class="form-group">
      <label for="id_status">Status:</label>
      {{ form.status }}
    </div>

    <div class="form-group">
      <label for="id_quantidade">Quantidade:</label>
      {{ form.quantidade }}
    </div>

    <div class="form-group">
      <label for="id_precisa_preventiva">Precisa preventiva:</label>
      {{ form.precisa_preventiva }}
    </div>

    <div class="form-group">
      <label for="id_data_limite_preventiva">Data limite preventiva:</label>
      {{ form.data_limite_preventiva }}
    </div>

    <div class="form-group full-width">
      <label for="id_observacoes">Observações:</label>
      {{ form.observacoes }}
    </div>

    <button type="submit" id="submit-form">Salvar</button>
  </form>
  <a class="back-link" href="{% url 'home' %}">← Voltar à página inicial</a>
</div>
<script>
  // Ao trocar a categoria, filtra os subtipos exibidos
  document.addEventListener("DOMContentLoaded", function() {
    const categoriaSelect = document.getElementById('id_categoria');
    const subtipoSelect = document.getElementById('id_subtipo');

    function filtrarSubtipos() {
      const categoriaId = categoriaSelect.value;
      // Mostra só subtipos que pertencem à categoria selecionada
      Array.from(subtipoSelect.options).forEach(function(option) {
        if (option.value === "") {
          option.style.display = ""; // sempre mostra o "Selecione..."
        } else if (option.getAttribute('data-categoria') === categoriaId) {
          option.style.display = "";
        } else {
          option.style.display = "none";
        }
      });
      // Limpa subtipo selecionado se não for compatível
      if (
        subtipoSelect.selectedIndex > 0 &&
        subtipoSelect.options[subtipoSelect.selectedIndex].style.display === "none"
      ) {
        subtipoSelect.selectedIndex = 0;
      }
    }

    categoriaSelect.addEventListener('change', filtrarSubtipos);
    // Aplica filtro ao carregar página (útil ao editar)
    filtrarSubtipos();
  });
</script>
{% endblock %}