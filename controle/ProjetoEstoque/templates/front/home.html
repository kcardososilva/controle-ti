{% extends 'base.html' %}

{% block title %}Controle de Ativos{% endblock %}

{% block content %}
<style>
body {
  background: #f5f7fa;
  font-family: 'Roboto', Arial, sans-serif;
  margin: 0;
  padding: 0;
}
.dashboard-container {
  max-width: 830px;
  margin: 18px auto 0 auto;
  padding: 0 10px;
}
.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(145px, 1fr));
  gap: 12px;
  margin-bottom: 15px;
}
.dashboard-card {
  background: #213358;
  border-radius: 10px;
  box-shadow: 0 1px 7px #b7c2d70c;
  padding: 12px 10px 10px 10px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-width: 0;
  border: 1px solid #f1f3f7;
  transition: box-shadow .17s;
  
}
.dashboard-card:hover { box-shadow: 0 2px 10px #abbedb15; }
.card-icon { font-size: 1.25rem; margin-bottom: 3px; color: #62b8f6; opacity: 0.90;}
.card-green { color: #34c88a; }
.card-red   { color: #ff6371; }
.card-blue  { color: #2491ff; }
.card-orange { color: #ffad44; }
.card-purple { color: #bb8fff;}
.card-title { font-size: 0.92rem; font-weight: 700; color: #fff; margin-bottom: 1px;}
.card-value { font-size: 1.13rem; font-weight: bold; color: #fff;}
.card-desc  { font-size: 0.85rem; color: #fff; }
@media (max-width: 650px) {
  .dashboard-container { padding: 0 3vw;}
  .cards-grid { gap: 7px;}
  .dashboard-card { padding: 9px 7px 8px 7px;}
  .card-title, .card-desc { font-size: 0.8rem;}
  .card-value { font-size: 0.95rem;}
  .card-icon { font-size: 1rem;}
}

/* Tabela e Filtros */
.tabela-container {
  background: #191f2f;
  margin: 0 auto;
  max-width: 1150px;
  border-radius: 13px;
  box-shadow: 0 4px 30px #0001;
  padding: 22px 18px 12px 18px;
  overflow-x: auto;
  box-sizing: border-box;
}
.top-actions {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 12px;
  flex-wrap: wrap;
  gap: 12px;
}
.btn-exportar {
  background: linear-gradient(90deg, #172133 20%, #484f4f 100%);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-weight: 700;
  font-size: 1.05rem;
  padding: 8px 24px 8px 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 2px 9px #2ed6a425;
  transition: background .16s, box-shadow .12s;
  text-decoration: none;
}
.btn-exportar i { font-size: 1.13em; }
.btn-exportar:hover {
  background: linear-gradient(90deg, #172133 20%, #484f4f 100%);
  box-shadow: 0 3px 16px #14e5b232;
}
.filtros-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 14px 18px;
  margin-bottom: 18px;
  align-items: end;
}
.filtro-group { display: flex; flex-direction: column; width: 100%; }
.filtro-icon-input { position: relative; width: 100%; }
.filtro-icon-input i {
  color: #172133 !important;
  position: absolute;
  left: 12px; top: 50%;
  transform: translateY(-50%);
  font-size: 1em; pointer-events: none; z-index: 2;
}
.filtro-icon-input input,
.filtro-icon-input select {
  width: 100%;
  font-size: 1em;
  border: 1px solid #d4dbe5;
  border-radius: 8px;
  background: #f7fafc;
  color: #273046;
  padding: 8px 10px 8px 36px;
  height: 39px;
  box-sizing: border-box;
  font-family: inherit;
  outline: none;
  transition: border .13s;
}
.filtro-icon-input select { appearance: none; }
.filtro-actions {
  display: flex;
  gap: 10px;
  align-items: center;
  width: 100%;
  margin-top: 4px;
  grid-column: 1/-1;
}
.btn-filtrar {
  background: linear-gradient(90deg, #757e8e 20%, #484f4f 100%);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-weight: 700;
  font-size: 1.04rem;
  padding: 8px 22px;
  cursor: pointer;
  transition: background .13s;
  display: flex; align-items: center; gap: 8px;
}
.btn-filtrar:hover { background: #484f4f; }
.btn-limpar {
  background: #f7fafc;
  border: 1.5px solid #dbe6f1;
  color: #7a869a;
  font-size: 1.04rem;
  font-weight: 600;
  padding: 8px 20px;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
}
.btn-limpar:hover {
  background: #f0f5fb;
  color: #2491ff;
  border-color: #aad1ff;
}

/* RESPONSIVIDADE DOS FILTROS */
@media (max-width: 1100px) {
  .filtros-row { grid-template-columns: repeat(2, 1fr);}
}
@media (max-width: 750px) {
  .tabela-container { padding: 6px 0.5vw 12px 0.5vw;}
  .filtros-row { grid-template-columns: 1fr;}
  .filtro-actions { flex-direction: column; gap: 8px;}
}

/* TABELA */
.tabela-equipamentos {
  width: 100%;
  border-collapse: collapse;
  margin-top: 8px;
  font-size: 1em;
  min-width: 800px;
  background: #213358;

}
.tabela-equipamentos th, .tabela-equipamentos td {
  padding: 10px 10px;
  border-bottom: 1px solid #eaeaea;
  text-align: left;
  word-break: break-word;
  font-size: 13px;
}
.tabela-equipamentos th {
  color: white;
  background: #101521;
  font-weight: 700;
  cursor: pointer;
  user-select: none;
  font-size: 1em;
  border-radius: 3% ;
}
.tabela-equipamentos tbody tr:hover {
  background: #101521;
  transition: background .14s;
}
.td-acoes { text-align: center; min-width: 80px; white-space: nowrap;}
.td-acoes .icon-btn {
  background: #fff;
  border: 1.4px solid #e7eaf1;
  color: #484f4f;
  border-radius: 50%;
  padding: 7px 9px 7px 9px;
  margin: 0 2px;
  font-size: 1.13em;
  cursor: pointer;
  transition: background 0.16s, color 0.13s, border 0.11s;
  vertical-align: middle;
}
.td-acoes .icon-btn.view { color: #484f4f; }
.td-acoes .icon-btn.delete { color: #ff4141; }
.td-acoes .icon-btn:hover { background: #f6f9ff; border-color: #d5e9ff;}
.status.Ativo { background: #e2f6ea; color: #21b077; font-weight: 600; border-radius: 7px; padding: 2px 11px; font-size: .98em;}
.status.Backup { background: #e8f4fa; color: #1c72b7; font-weight: 600; border-radius: 7px; padding: 2px 11px; font-size: .98em;}
.status.Manutencao { background: #fff7e6; color: #c7810b; font-weight: 600; border-radius: 7px; padding: 2px 11px; font-size: .98em;}
.status.Defeitos, .status.Defeito { background: #ffe6e6; color: #d32222; font-weight: 600; border-radius: 7px; padding: 2px 11px; font-size: .98em;}
@media (max-width: 900px) {
  .tabela-equipamentos th, .tabela-equipamentos td { padding: 7px 6px; font-size: 0.98em;}
  .td-acoes .icon-btn { font-size: 1em; padding: 6px 7px;}
  .tabela-equipamentos { min-width: 750px;}
}
@media (max-width: 700px) {
  .tabela-equipamentos th, .tabela-equipamentos td { padding: 6px 4px; font-size: 0.95em;}
  .tabela-equipamentos { min-width: 600px;}
}
/* Tabela rola horizontal no mobile */
@media (max-width: 600px) {
  .tabela-container { padding: 0 2vw;}
  .tabela-equipamentos th, .tabela-equipamentos td { font-size: 0.92em; padding: 5px 2px;}
  .tabela-equipamentos { min-width: 550px;}
  .cards-grid { grid-template-columns: repeat(2, 1fr);}
}
</style>

<div class="content">
  <div class="dashboard-container">
    <div class="cards-grid">
      <div class="dashboard-card">
        <i class="fa fa-circle card-icon card-green"></i>
        <div class="card-title">Ativos</div>
        <div class="card-value">{{ total_ativos }}</div>
        <div class="card-desc">Em uso</div>
      </div>
      <div class="dashboard-card">
        <i class="fa fa-database card-icon card-blue"></i>
        <div class="card-title">Backup</div>
        <div class="card-value">{{ total_backup }}</div>
        <div class="card-desc">Em backup</div>
      </div>
      <div class="dashboard-card">
        <i class="fa fa-tools card-icon card-orange"></i>
        <div class="card-title">Manutenção</div>
        <div class="card-value">{{ total_manutencao }}</div>
        <div class="card-desc">Em manutenção</div>
      </div>
      <div class="dashboard-card">
        <i class="fa fa-exclamation-circle card-icon card-red"></i>
        <div class="card-title">Defeitos</div>
        <div class="card-value">{{ total_queimados }}</div>
        <div class="card-desc">Com defeito</div>
      </div>
      <div class="dashboard-card">
        <i class="fa fa-layer-group card-icon card-purple"></i>
        <div class="card-title">Total</div>
        <div class="card-value">{{ total_geral }}</div>
        <div class="card-desc">Cadastrados</div>
      </div>
    </div>
  </div>

  <div class="tabela-container">
    <div class="top-actions">
      <a class="btn-exportar" href="{% url 'exportar_equipamentos' %}">
        <i class="fa fa-file-export"></i> Exportar Dados
      </a>
    </div>

    <!-- FILTROS -->
    <form class="filtros-row" autocomplete="off" method="get">
      <div class="filtro-group">
        <div class="filtro-icon-input">
          <i class="fa fa-search"></i>
          <input type="text" name="nome" id="filtro-nome" placeholder="Buscar por nome..." value="{{ request.GET.nome|default:'' }}">
        </div>
      </div>
      <div class="filtro-group">
        <div class="filtro-icon-input">
          <i class="fa fa-layer-group"></i>
          <select name="categoria" id="filtro-categoria">
            <option value="">Todas Categorias</option>
            {% for cat in categorias %}
              <option value="{{ cat.id }}" {% if request.GET.categoria == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.nome }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="filtro-group">
        <div class="filtro-icon-input">
          <i class="fa fa-tags"></i>
          <select name="subtipo" id="filtro-subtipo">
            <option value="">Todos Subtipos</option>
            {% for sub in subtipos %}
              <option value="{{ sub.id }}" {% if request.GET.subtipo == sub.id|stringformat:"s" %}selected{% endif %}>{{ sub.nome }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="filtro-group">
        <div class="filtro-icon-input">
          <i class="fa fa-circle"></i>
          <select name="status" id="filtro-status">
            <option value="">Todos Status</option>
            {% for code, label in status_choices %}
              <option value="{{ code }}" {% if request.GET.status == code %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="filtro-group">
        <div class="filtro-icon-input">
          <i class="fa fa-barcode"></i>
          <input type="text" name="numero_serie" id="filtro-num-serie" placeholder="Buscar nº de série..." value="{{ request.GET.numero_serie|default:'' }}">
        </div>
      </div>
      <div class="filtro-group">
        <div class="filtro-icon-input">
          <i class="fa fa-user"></i>
          <input type="text" name="usuario" id="filtro-usuario" placeholder="Buscar usuário..." value="{{ request.GET.usuario|default:'' }}">
        </div>
      </div>
      <div class="filtro-group">
        <div class="filtro-icon-input">
          <i class="fa fa-location-dot"></i>
          <input type="text" name="localidade" id="filtro-localidade" placeholder="Buscar localidade..." value="{{ request.GET.localidade|default:'' }}">
        </div>
      </div>
      <div class="filtro-group">
        <div class="filtro-icon-input">
          <i class="fa fa-coins"></i>
          <input type="text" name="centro_custo" id="filtro-centro-custo" placeholder="Centro de custo..." value="{{ request.GET.centro_custo|default:'' }}">
        </div>
      </div>
      <div class="filtro-actions">
        <button class="btn-filtrar" type="submit"><i class="fa fa-filter"></i> Filtrar</button>
        <button class="btn-limpar" type="reset" onclick="window.location.href=window.location.pathname"><i class="fa fa-eraser"></i> Limpar</button>
      </div>
    </form>

    <!-- TABELA -->
    <div style="width:100%;overflow-x:auto;">
      <table class="tabela-equipamentos" id="tabelaEquipamentos">
        <thead>
          <tr>
            <th>#</th>
            <th>Nome</th>
           
            <th>Subtipo</th>
            <th>Status</th>
            <th>Usuário</th>
            <th>Localidade</th>

            <th>Nº Série</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
        {% for equipamento in equipamentos %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ equipamento.nome }}</td>
          
          <td>{{ equipamento.subtipo }}</td>
          <td><span class="status {{ equipamento.status }}">{{ equipamento.get_status_display }}</span></td>
          <td>Usuário</td>
          <td>{{ equipamento.local }}</td>
        
          <td>{{ equipamento.numero_serie }}</td>
          <td class="td-acoes">
              <a class="icon-btn view" title="Visualizar" href="{% url 'equipamento_detalhe' equipamento.id %}"><i class="fa fa-eye"></i></a>
              <a class="icon-btn delete" title="Excluir" href="{% url 'excluir_equipamento' equipamento.id %}"><i class="fa fa-trash"></i></a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="10" style="text-align: center;">Nenhum equipamento encontrado.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
