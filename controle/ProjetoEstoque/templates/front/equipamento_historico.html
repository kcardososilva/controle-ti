{% extends 'base.html ' %}

{% block title  %}Hist√≥rico - {{ equipamento.nome }}{% endblock %}

{% block content %}
<style>
.card-ciclo {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 20px;
}

.card-etapa {
  background: #f9f9f9;
  padding: 10px 16px;
  border-radius: 6px;
  margin-bottom: 12px;
}

.card-etapa.queima {
  border-left: 5px solid #dc3545;
}

.card-etapa.manutencao {
  border-left: 5px solid #ffc107;
}

.card-etapa.retorno {
  border-left: 5px solid #28a745;
}

.dashboard-box {
  flex: 1;
  background: #4F7A79;
  color: white;
  padding: 16px;
  border-radius: 10px;
  text-align: center;
  margin-right: 16px;
}

.dashboard-box:last-child {
  margin-right: 0;
}
</style>

<h2 class="text-xl font-bold mb-6">Hist√≥rico de Manuten√ß√µes - {{ equipamento.nome }}</h2>
<a href="{% url 'exportar_historico_excel' equipamento.id %}" class="btn btn-success" style="color: #4F7A79;">
  üìÅ Exportar para Excel
</a>

<div style="display: flex; margin-bottom: 20px;">
  <div class="dashboard-box">
    <h3>{{ ciclos|length }}</h3>
    <p>Total de Ciclos</p>
  </div>
  <div class="dashboard-box">
    <h3>R$ {{ total_gasto|floatformat:2 }}</h3>
    <p>Gasto Total</p>
  </div>
</div>

{% for ciclo in ciclos %}
  <div class="card-ciclo">
    <h4 class="text-lg font-semibold mb-2">üîÑ Ciclo {{ forloop.counter }}</h4>
    {% for etapa in ciclo %}
      {% if etapa.tipo == 'manutencao' %}
        <div class="card-etapa manutencao">
          <strong>Status:</strong> Em manuten√ß√£o <br>
          <strong>Data:</strong> {{ etapa.data_criacao|date:"d/m/Y H:i" }} <br>
          <strong>Respons√°vel:</strong> {{ etapa.autor }}
        </div>
      {% else %}
        <div class="card-etapa {{ etapa.tipo }}">
          <strong>Status:</strong> {{ etapa.get_tipo_display }} <br>
          <strong>Causa:</strong> {{ etapa.causa|default:"‚Äî" }} <br>
          <strong>Custo:</strong> R$ {{ etapa.custo|default:"0.00"|floatformat:2 }} <br>
          <strong>Data:</strong> {{ etapa.data_criacao|date:"d/m/Y H:i" }} <br>
          <strong>Respons√°vel:</strong> {{ etapa.autor|default:"‚Äî" }}
        </div>
      {% endif %}
    {% endfor %}
  </div>
{% empty %}
  <p>Nenhum hist√≥rico registrado para este equipamento.</p>
{% endfor %}
{% endblock %}
