{% extends 'base.html' %}
{% block title %}Mapa de Custos por √Årea{% endblock %}
{% block content %}

<style>
  .filtro-form {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }

  .filtro-form label {
    font-weight: bold;
    margin-right: 10px;
  }

  .filtro-form select {
    padding: 6px 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
    min-width: 200px;
  }

  .tabela-custos {
    width: 100%;
    border-collapse: collapse;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    background: white;
    border-radius: 8px;
    overflow: hidden;
  }

  .tabela-custos th, .tabela-custos td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid #eee;
    font-family: Trebuchet MS, sans-serif;
  }

  .tabela-custos th {
    background-color: #6898A0;
    color: white;
    text-transform: uppercase;
    font-size: 14px;
    font-family: Trebuchet MS, sans-serif;
  }

  .tabela-custos tr:hover {
    background-color: #f5f5f5;
  }

  .titulo-dashboard {
    color: #4F7A79;
    font-weight: 600;
    font-size: 24px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .btn-exportar {
    background-color: #e8f4f2;
    padding: 8px 16px;
    border-radius: 6px;
    color: #4F7A79;
    text-decoration: none;
    border: 1px solid #4F7A79;
    margin-top: 10px;
    display: inline-block;
    font-weight: 600;
  }

  .btn-exportar:hover {
    background-color: #c7e0dd;
  }

  @media screen and (max-width: 768px) {
    .filtro-form {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }

    .tabela-custos th, .tabela-custos td {
      font-size: 14px;
      padding: 8px;
    }
  }
</style>

<div class="titulo-dashboard">
  <span>üìä</span>
  <span>Mapa de Custos</span>
</div>

<form method="get" class="filtro-form">
  <div>
    <label for="filtro">Filtro:</label>
    <select name="filtro" id="filtro" onchange="this.form.submit()">
      <option value="por_area" {% if filtro_selecionado == 'por_area' %}selected{% endif %}>Por Local</option>
      <option value="equipamentos_mais_defeitos" {% if filtro_selecionado == 'equipamentos_mais_defeitos' %}selected{% endif %}>Por Equipamento com Mais Defeitos</option>
      <option value="subtipos_mais_defeitos" {% if filtro_selecionado == 'subtipos_mais_defeitos' %}selected{% endif %}>Por Subtipo com Mais Defeitos</option>
    </select>
  </div>

  <a href="{% url 'exportar_custos_area' %}?filtro={{ filtro_selecionado }}"
    class="btn-exportar" style="background-color: #6898A0;; color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none;">
    üìÅ Exportar Excel
  </a>
</form>

<table class="tabela-custos">
  <thead>
    {% if filtro_selecionado == 'equipamentos_mais_defeitos' %}
    <tr>
      <th>Nome</th>
      <th>Subtipo</th>
      <th>Localiza√ß√£o | Setor</th>
      <th>Qtd. Defeitos</th>
      <th>Total Gasto (R$)</th>
    </tr>
    {% elif filtro_selecionado == 'subtipos_mais_defeitos' %}
    <tr>
      <th>Subtipo</th>
      <th>Qtd. Ciclos</th>
      <th>Total Gasto (R$)</th>
    </tr>
    {% else %}
    <tr>
      <th>√Årea / Local</th>
      <th>Qtd. Equipamentos</th>
      <th>Total de Ciclos</th>
      <th>Total Gasto (R$)</th>
    </tr>
    {% endif %}
  </thead>
  <tbody>
    {% if filtro_selecionado == 'equipamentos_mais_defeitos' %}
      {% for id, eq in dados_area.items %}
        <tr>
            <td>{{ eq.nome }}</td>
            <td>{{ eq.subtipo }}</td>
            <td>{{ eq.local }}</td>
            <td>{{ eq.total_ciclos }}</td>
            <td>R$ {{ eq.custo_total|floatformat:2 }}</td>
        </tr>
      {% endfor %}
    {% elif filtro_selecionado == 'subtipos_mais_defeitos' %}
      {% for subtipo, dados in dados_area.items %}
        <tr>
          <td>{{ subtipo }}</td>
          <td>{{ dados.total_ciclos }}</td>
          <td>R$ {{ dados.custo_total|floatformat:2 }}</td>
        </tr>
      {% endfor %}
    {% else %}
      {% for area, dados in dados_area.items %}
        <tr>
          <td>{{ area }}</td>
          <td>{{ dados.quantidade_equipamentos }}</td>
          <td>{{ dados.total_ciclos }}</td>
          <td>R$ {{ dados.custo_total|floatformat:2 }}</td>
        </tr>
      {% endfor %}
    {% endif %}
  </tbody>
</table>

{% endblock %}
