{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Login - Controle TI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="icon" href="{% static 'img/logo2.png' %}">

  <style>
    :root{
      /* Paleta profissional (neutra porém viva) */
      --bg1:#0e1526; --bg2:#1b2942;
      --ink:#0f172a; --ink-inv:#e6edf7; --muted:#64748b;
      --card:#ffffff; --card-ghost:rgba(255,255,255,.9);
      --line:#e6ecf5; --line-ghost:#ffffff40;
      --brand1:#1e3a8a; --brand2:#2563eb;
      --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
      --shadow-lg:0 18px 50px rgba(2,6,23,.25);
      --shadow-md:0 10px 28px rgba(2,6,23,.18);
      --rad:16px;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg1:#0a0f1e; --bg2:#121a2e;
        --ink:#e6edf7; --ink-inv:#0f172a; --muted:#9fb0c8;
        --card:#0f172a; --card-ghost:rgba(15,23,42,.85);
        --line:#23324b; --line-ghost:#23324b;
        --shadow-lg:0 18px 50px rgba(0,0,0,.55);
        --shadow-md:0 10px 28px rgba(0,0,0,.45);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; min-height:100vh; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background: radial-gradient(1200px 600px at 10% -10%, #1e3a8a22, transparent 60%),
                  radial-gradient(1200px 700px at 110% 10%, #0ea5e922, transparent 60%),
                  linear-gradient(120deg, var(--bg1) 0%, var(--bg2) 100%);
      display:flex; align-items:center; justify-content:center; padding:24px;
    }

    .login-wrap{
      width:min(420px, 96vw);
      background:var(--card-ghost);
      border:1px solid var(--line-ghost);
      border-radius:var(--rad);
      box-shadow:var(--shadow-lg);
      backdrop-filter:saturate(135%) blur(8px);
      padding:26px 24px 22px;
      animation:pop .35s cubic-bezier(.27,.8,.22,1);
    }
    @keyframes pop{from{opacity:0; transform:translateY(16px) scale(.98)} to{opacity:1; transform:none}}

    .brand{
      text-align:center; margin-bottom:14px;
      display:flex; flex-direction:column; align-items:center; gap:8px;
    }
    .brand img{
      width:84px; height:84px; object-fit:contain; border-radius:14px;
      box-shadow:0 10px 24px #2563eb1a;
      background:#e6f2ff; padding:10px;
    }
    .brand h1{margin:0; font-size:1.35rem; font-weight:800; letter-spacing:.2px}
    .brand span{font-size:.95rem; color:var(--muted); font-weight:600}

    .errors{
      display:none; margin-bottom:8px;
      color:#991b1b; background:#fee2e2; border:1px solid #fecaca;
      border-radius:10px; padding:8px 10px; font-weight:600; font-size:.95rem;
    }

    form{display:flex; flex-direction:column; gap:14px}

    .field{
      position:relative;
    }
    .field input{
      width:100%; height:46px; border-radius:12px; border:1.4px solid var(--line);
      background:#f7f9fd; color:var(--ink); font-size:1rem; font-weight:600;
      padding:10px 40px 10px 42px; outline:none; transition:border .15s, box-shadow .15s, background .15s;
    }
    @media (prefers-color-scheme: dark){
      .field input{ background:#0c1222; border-color:#20304d; color:var(--ink); }
    }
    .field input::placeholder{color:#9aa7b8}
    .field input:focus{
      border-color:#93c5fd; box-shadow:0 0 0 3px #93c5fd33; background:#fff;
    }
    .field .icon{
      position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#5b708c; font-size:1.03rem;
    }
    .field label{
      position:absolute; left:42px; top:12px; color:#6b7280; pointer-events:none;
      transition:all .16s; font-weight:700;
    }
    .field input:focus + label,
    .field input:not(:placeholder-shown) + label{
      top:-9px; left:10px; font-size:.78rem; background:var(--card-ghost); padding:0 6px; color:#6b7280;
      border-radius:6px;
    }

    .toggle-pass{
      position:absolute; right:10px; top:50%; transform:translateY(-50%);
      border:none; background:transparent; color:#5b708c; cursor:pointer; font-size:1rem; padding:6px;
    }
    .caps{
      display:none; font-size:.85rem; color:#b45309; font-weight:800; margin-top:-6px;
    }

    .login-btn{
      height:46px; border:none; border-radius:12px; cursor:pointer;
      font-weight:900; font-size:1rem; letter-spacing:.3px; color:#fff;
      background:linear-gradient(90deg, var(--brand1), var(--brand2));
      box-shadow:var(--shadow-md);
      display:flex; align-items:center; justify-content:center; gap:10px;
      transition:filter .1s, transform .08s;
    }
    .login-btn:hover{ filter:brightness(.98) }
    .login-btn:active{ transform:translateY(1px) }

    .footer{
      margin-top:12px; text-align:center; color:var(--muted); font-weight:700; font-size:.95rem;
    }
    .footer .link{ color:#7aa2ff; cursor:pointer; text-decoration:underline }
    .footer .link:hover{ color:#3b82f6 }

    /* Modal Sobre */
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(2,6,23,.35); z-index:10}
    .modal.active{display:flex}
    .modal-card{
      background:var(--card); color:var(--ink); border:1px solid var(--line);
      border-radius:14px; width:min(480px,94vw); padding:20px 18px 14px; box-shadow:var(--shadow-lg)
    }
    .modal-card h3{margin:0 0 6px; font-size:1.08rem}
    .modal-card p{margin:0; color:var(--muted); font-weight:600}
    .close{
      border:none; background:#f3f6fb; color:#0f172a; border:1px solid var(--line);
      padding:7px 12px; border-radius:10px; font-weight:900; margin-top:12px; cursor:pointer;
    }
    @media (prefers-color-scheme: dark){
      .close{ background:#0c1222; color:#e6edf7; border-color:#20304d }
    }

    /* Responsividade */
    @media (max-width:380px){
      .login-wrap{ padding:18px 14px 14px }
      .brand img{ width:72px; height:72px }
    }
  </style>
</head>
<body>

  <div class="login-wrap" role="dialog" aria-labelledby="tituloLogin">
    <!-- Branding -->
    <div class="brand">
      <img src="{% static 'img/logo2.png' %}" alt="Logo Controle TI">
      <h1 id="tituloLogin">Controle TI</h1>
      <span>Acesso seguro ao painel</span>
    </div>

    <!-- Bloco de erros -->
    <div id="errors" class="errors" aria-live="assertive">
      {% if form.errors or form.non_field_errors %}
        {% for field in form %}
          {% for error in field.errors %}
            {{ error }}<br>
          {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
          {{ error }}<br>
        {% endfor %}
        <script>document.currentScript.parentElement.style.display='block'</script>
      {% endif %}
    </div>

    <!-- Form -->
    <form method="post" action="{% url 'login' %}" autocomplete="off" novalidate>
      {% csrf_token %}

      <div class="field">
        <input type="text" id="id_username" name="username" placeholder=" " required
               autocomplete="username" value="{{ form.username.value|default_if_none:'' }}">
        <label for="id_username">Usuário</label>
        <i class="fa fa-user icon" aria-hidden="true"></i>
      </div>

      <div class="field">
        <input type="password" id="id_password" name="password" placeholder=" " required
               autocomplete="current-password">
        <label for="id_password">Senha</label>
        <i class="fa fa-lock icon" aria-hidden="true"></i>
        <button class="toggle-pass" type="button" id="togglePass" aria-label="Mostrar senha">
          <i class="fa fa-eye"></i>
        </button>
      </div>

      <div id="capsWarn" class="caps"><i class="fa fa-keyboard"></i> Caps Lock ativado</div>

      <button type="submit" class="login-btn">
        <i class="fa fa-right-to-bracket"></i> Entrar
      </button>
    </form>

    <div class="footer">
      © {{ now|date:"Y" }} Controle TI
      <br>
      <span class="link" id="sobreBtn">Sobre a plataforma</span>
    </div>
  </div>

  <!-- Modal Sobre -->
  <div class="modal" id="modalSobre" aria-hidden="true">
    <div class="modal-card" role="document" aria-labelledby="sobreTitulo">
      <h3 id="sobreTitulo"><i class="fa fa-network-wired"></i> Sobre</h3>
      <p>
        Plataforma de gestão de ativos, licenças e preventivas de TI com foco em
        performance, rastreabilidade e usabilidade. Responsiva, moderna e segura.
        <br><br><b>Autor:</b> Kayque Cardoso — <b>Versão:</b> 3.0
      </p>
      <button class="close" id="closeSobre">Fechar</button>
    </div>
  </div>

  <script>
    // Mostrar/ocultar senha
    const pass = document.getElementById('id_password');
    const toggle = document.getElementById('togglePass');
    toggle?.addEventListener('click', () => {
      const is = pass.type === 'password';
      pass.type = is ? 'text' : 'password';
      toggle.innerHTML = is ? '<i class="fa fa-eye-slash"></i>' : '<i class="fa fa-eye"></i>';
      toggle.setAttribute('aria-label', is ? 'Ocultar senha' : 'Mostrar senha');
      pass.focus();
    });

    // Aviso de Caps Lock
    const caps = document.getElementById('capsWarn');
    function capsCheck(e){
      const on = e.getModifierState && e.getModifierState('CapsLock');
      caps.style.display = on ? 'block' : 'none';
    }
    pass.addEventListener('keyup', capsCheck);
    pass.addEventListener('keydown', capsCheck);

    // Modal Sobre
    const modal = document.getElementById('modalSobre');
    const openBtn = document.getElementById('sobreBtn');
    const closeBtn = document.getElementById('closeSobre');
    openBtn?.addEventListener('click', ()=>{ modal.classList.add('active'); modal.setAttribute('aria-hidden','false'); });
    closeBtn?.addEventListener('click', ()=>{ modal.classList.remove('active'); modal.setAttribute('aria-hidden','true'); });
    modal?.addEventListener('click', (e)=>{ if(e.target===modal) { modal.classList.remove('active'); modal.setAttribute('aria-hidden','true'); } });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') { modal.classList.remove('active'); modal.setAttribute('aria-hidden','true'); } });

    // Submeter com Enter no último campo de forma previsível
    pass.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.target.form.requestSubmit(); } });
  </script>
</body>
</html>
